<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Danh Sách Bài Đăng</title>
		<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	</head>
	<body>
		{% include 'header.html' %}
		{% include 'message.html' %}

		<div class="container mt-5">
			<h1 class="text-center mb-4">Danh Sách Bài Đăng</h1>

			<!-- Form lọc theo page và status -->
			<form method="GET" action="{{ url_for('stack_post.index') }}">
				<div class="row mb-4">
					<div class="col-md-4">
						<label for="page_id" class="form-label">Chọn Trang</label>
						<select name="page_id" id="page_id" class="form-select">
							<option value="">Tất cả trang</option>
							{% for page in pages %}
							<option value="{{ page.id }}" {% if page.id == request.args.get('page_id') %} selected {% endif %}>
								{{ page.name }}</option>
							{% endfor %}
						</select>
					</div>

					<div class="col-md-4">
						<label for="status" class="form-label">Chọn Trạng Thái</label>
						<select name="status" id="status" class="form-select">
							<option value="">Tất cả trạng thái</option>
							<option value="waiting" {% if request.args.get('status') == 'waiting' %} selected {% endif %}>Chờ</option>
							<option value="processing" {% if request.args.get('status') == 'processing' %} selected {% endif %}>Đang
								xử lý</option>
							<option value="posted" {% if request.args.get('status') == 'posted' %} selected {% endif %}>Đã đăng
							</option>
							<option value="error" {% if request.args.get('status') == 'error' %} selected {% endif %}>Lỗi</option>
						</select>
					</div>

					<div class="col-md-4 d-flex align-items-end">
						<button type="submit" class="btn btn-primary">Lọc</button>
					</div>
				</div>
			</form>

			<!-- Bảng hiển thị danh sách bài đăng -->
			<table class="table table-bordered table-striped">
				<thead class="table-light">
					<tr>
						<th>Tiêu Đề</th>
						<th>Trang</th>
						<th>Thời Gian</th>
						<th>Trạng Thái</th>
						<th>Thao Tác</th>
					</tr>
				</thead>
				<tbody>
					{% for post in stack_posts %}
					<tr>
						<td>{{ post.title }}</td>
						<td>{{ post.page.name }}</td>
						<td>{{ post.time }}</td>
						<td>
							<span class="badge 
                                {% if post.status == 'waiting' %} bg-warning {% endif %}
                                {% if post.status == 'processing' %} bg-info {% endif %}
                                {% if post.status == 'posted' %} bg-success {% endif %}
                                {% if post.status == 'error' %} bg-danger {% endif %}
                            ">{{ post.status }}</span>
						</td>
						<td>
							<form method="POST" action="{{ url_for('stack_post.post_video', post_id=post.id) }}" class="d-inline">
								{{ form.csrf_token }} <!-- CSRF token -->
								<button type="submit" class="btn btn-primary btn-sm">Đăng Video</button>
							</form>
						</td>
					</tr>
					{% else %}
					<tr>
						<td colspan="5" class="text-center">Không có bài đăng nào.</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>