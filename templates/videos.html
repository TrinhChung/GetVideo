<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
		<title>Danh sách Video</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
		<!-- Thêm Font Awesome -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
		<style>
			/* Ensure word wrap in the title column */
			.table td,
			.table th {
				white-space: normal !important;
			}

			/* Increase width of the "Tải Video" column */
			.table td:last-child {
				width: 150px;
			}

			.table th:nth-child(3) {
				width: 150px;
			}

			/* Điều chỉnh độ rộng của cột đường dẫn */
			.table td:nth-child(4) {
				width: 400px;
				/* Bạn có thể điều chỉnh giá trị này cho phù hợp */
				word-wrap: break-word;
				/* Đảm bảo rằng văn bản dài sẽ xuống dòng */
				white-space: normal !important;
				/* Cho phép xuống dòng trong cột */
			}
		</style>
	</head>
	<body>
		{% include 'header.html' %}
		{% include 'message.html' %}
		<div class="container mt-5">
			<h1 class="text-center mb-4">Danh sách Video Playlist</h1>

			<!-- Button Tải tất cả với icon -->
			<form method="POST" action="{{ url_for('video.download_all_videos') }}" class="mt-4">
				{{ form.csrf_token }} <!-- CSRF token -->
				<button type="submit" class="btn btn-danger">
					<i class="fas fa-download"></i> Tải Tất Cả Video
				</button>
			</form>

			<!-- Hiển thị danh sách video -->
			<h3 class="mt-5">Danh sách Video</h3>
			<table class="table table-bordered mt-3">
				<thead class="table-light">
					<tr>
						<th>ID</th>
						<th>Playlist ID</th>
						<th>Thời gian</th>
						<th>Đường dẫn</th>
						<th>Tải Video</th>
						<th>Split Video</th> <!-- Cột Split mới -->
					</tr>
				</thead>
				<tbody>
					{% for video in videos %}
					<tr>
						<td>{{ video.id }}</td>
						<td>{{ video.playlist_id }}</td>
						<td data-duration="{{ video.duration if video.duration else '' }}">
							{{ video.duration if video.duration else 'Chưa có thông tin' }}
						</td>
						<td>{{ video.path if video.path else 'Chưa có đường dẫn' }}</td>
						{% if not video.crawled %}
						<td>
							<form method="GET" action="{{ url_for('video.download_video_route', video_id=video.video_id) }}">
								<button type="submit" class="btn btn-success">
									<i class="fas fa-download"></i> Tải Video
								</button>
							</form>
						</td>
						{% else %}
						<td class="text-center">
							<span class="text-success">Đã tải xong</span>
						</td>
						{% endif %}
						<!-- Nút Split video -->
						{% if video.path %}
						<td>
							<form method="POST" action="{{ url_for('video.split_video_route', video_id=video.video_id) }}">
								{{ form.csrf_token }} <!-- CSRF token -->
								<button type="submit" class="btn btn-warning">Split Video</button>
							</form>
						</td>
						{% else %}
						<td class="text-center">
							<span class="text-muted">--</span>
						</td>
						{% endif %}
					</tr>
					{% else %}
					<tr>
						<td colspan="6" class="text-center">Không có video nào để hiển thị.</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-OgVRvuATP1z7JjHLkuOU63t63E9UK9R1DlmAy1UoZlZpkjr/ZpZqgs3bzAv29ZjX"
			crossorigin="anonymous"></script>
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				// Hàm chuyển đổi giây thành phút và giây
				function convertDurationToMinutes(duration) {
					const totalSeconds = parseInt(duration, 10);
					if (isNaN(totalSeconds)) return "Chưa có thông tin";

					const minutes = Math.floor(totalSeconds / 60);
					const seconds = totalSeconds % 60;

					return seconds > 0 ? `${minutes} phút ${seconds} giây` : `${minutes} phút`;
				}

				// Lấy tất cả các ô chứa thời gian
				const durationCells = document.querySelectorAll("td[data-duration]");

				// Lặp qua và cập nhật nội dung
				durationCells.forEach((cell) => {
					const duration = cell.getAttribute("data-duration");
					cell.textContent = convertDurationToMinutes(duration);
				});
			});
		</script>

	</body>
</html>